<!-- 勘定科目の一覧定義 -->
<datalist id="accounts_datalist">
  <% @accounts.each do |account| %>
    <option value="<%= account.name %>" data-account-id="<%= account.id %>"></option>
  <% end %>
</datalist>

<div class="max-w-6xl mx-auto min-h-screen">
  <div class="bg-white border-4 border-black shadow-2xl">
    <div class="flex justify-between items-center bg-gray-100 px-8 py-6 border-b-4 border-black">
      <h1 class="text-3xl font-mono tracking-wide">仕訳入力</h1>
      <a href="/journal_entries" aria-label="戻る">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-8">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
        </svg>
      </a>
    </div>

    <%= form_with model: @journal_entry, local: true, class: "p-8" do |form| %>
      <%= hidden_field_tag :lines, params[:lines] if params[:lines].present? %>

      <% if @journal_entry.errors.any? %>
        <div class="bg-red-50 border-2 border-red-800 text-red-800 px-6 py-4 mb-6 font-mono">
          <strong>エラーが発生しました:</strong>
          <ul class="list-disc list-inside">
            <% @journal_entry.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <% if flash[:notice].present? %>
        <div class="bg-gray-50 border-2 px-6 py-4 mb-6 font-mono">
          <p><%= flash[:notice] %></p>
        </div>
      <% end %>

      <div class="border-2 border-black mb-8">
        <div class="grid grid-cols-2 gap-0">
          <%= form.label :entry_date, "仕訳日", class: "block w-full h-full border-[0.5] border-black bg-gray-100 py-2 text-center font-mono" %>
          <%= form.date_field :entry_date, autofocus: true, class: "w-full h-full px-2 py-2 border-l-[0.5] border-b-[0.5] font-mono text-sm focus:outline-none focus:bg-yellow-100" %>
        </div>
        <div class="grid grid-cols-2 gap-0">
          <%= form.label :summary, "摘要", class: "block w-full h-full border-[0.5] border-black bg-gray-100 py-2 text-center font-mono" %>
          <%= form.text_field :summary, placeholder: "取引の内容を入力してください", class: "w-full h-full px-2 py-2 border-l-[0.5] border-y-[0.5] font-mono text-sm focus:outline-none focus:bg-yellow-100" %>
        </div>

        <div class="grid grid-cols-12">
          <!-- 借方ヘッダー -->
          <div class="col-span-6 bg-gray-100 py-2 text-center font-mono border-[0.5] border-black">
            借方
          </div>
          <!-- 貸方ヘッダー -->
          <div class="col-span-6 bg-gray-100 py-2 text-center font-mono border-[0.5] border-black">
            貸方
          </div>
          <!-- 借方列ヘッダー -->
          <div class="col-span-3 border-[0.5] border-black bg-gray-100 py-2 text-center font-mono text-sm">勘定科目</div>
          <div class="col-span-3 border-[0.5] border-black bg-gray-100 py-2 text-center font-mono text-sm">金額</div>
            <!-- 貸方列ヘッダー -->
          <div class="col-span-3 border-[0.5] border-black bg-gray-100 py-2 text-center font-mono text-sm">勘定科目</div>
          <div class="col-span-3 border-[0.5] border-black bg-gray-100 py-2 text-center font-mono text-sm">金額</div>

          <!-- 明細行 -->
          <% @journal_entry_lines.each_with_index do |line, idx| %>
            <%= render "line",
                field_name: "journal_entry[journal_entry_lines_attributes][#{idx}]",
                side: line.side,
                accounts: @accounts,
                selected_account_name: line.account_name,
                amount_value: line.formatted_amount_for_input,
                is_persisted: line.persisted?,
                line_id: line.persisted? ? line.id : nil %>
          <% end %>
        </div>
      </div>

      <div class="flex justify-center mt-8">
        <%= form.submit "保存", class: "bg-black hover:bg-gray-800 focus:bg-gray-700 focus:ring-2 focus:ring-gray-400 focus:outline-none text-white py-4 px-12 border-2 border-black font-mono text-xl tracking-widest cursor-pointer" %>
      </div>
    <% end %>
  </div>
</div>
