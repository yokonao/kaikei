<div class="max-w-6xl mx-auto min-h-screen">
  <div class="bg-white border-4 border-black shadow-2xl">
    <div class="bg-gray-100 px-8 py-6 border-b-4 border-black">
      <h1 class="text-3xl font-bold font-mono tracking-wide">仕訳入力</h1>
    </div>

    <%= form_with model: @journal_entry, local: true, data: { controller: "journal-entry" }, class: "p-8" do |form| %>
      <% if @journal_entry.errors.any? %>
        <div class="bg-red-50 border-2 border-red-800 text-red-800 px-6 py-4 mb-6 font-mono">
          <strong>エラーが発生しました:</strong>
          <ul class="list-disc list-inside">
            <% @journal_entry.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="border border-black mb-8">
        <div class="bg-white border-2 border-black">
          <div class="grid grid-cols-2 gap-0">
            <%= form.label :entry_date, "仕訳日", class: "border-r border-b bg-gray-100 py-2 text-center font-mono font-bold" %>
            <%= form.date_field :entry_date, class: "w-full px-2 py-2 border-b font-mono text-sm focus:outline-none focus:bg-yellow-100" %>
          </div>
          <div class="grid grid-cols-2 gap-0">
            <%= form.label :summary, "摘要", class: "border-r border-b bg-gray-100 py-2 text-center font-mono font-bold" %>
            <%= form.text_field :summary, placeholder: "取引の内容を入力してください", class: "w-full px-2 py-2 border-b font-mono text-sm focus:outline-none focus:bg-yellow-100" %>
          </div>

          <!-- 左右分割レイアウト -->
          <div class="grid grid-cols-2 gap-0">

            <!-- 借方側 -->
            <div>
              <!-- 借方ヘッダー -->
              <div class="bg-gray-100 py-2 text-center font-mono font-bold border-b-1 border-r-1 border-black">
                借方
              </div>

              <!-- 借方列ヘッダー -->
              <div class="grid grid-cols-12 border-b bg-gray-100">
                <div class="col-span-6 border-r py-2 text-center font-mono font-bold text-sm">勘定科目</div>
                <div class="col-span-4 border-r py-2 text-center font-mono font-bold text-sm">金額</div>
                <div class="col-span-2 border-r py-2 text-center font-mono font-bold text-sm">削除</div>
              </div>

              <!-- 借方明細行 -->
              <div data-journal-entry-target="debitContainer">
                <%= form.fields_for :journal_entry_lines do |line_form| %>
                  <% if line_form.object.side == "debit" %>
                    <div class="grid grid-cols-12 border-b hover:bg-gray-50" data-journal-entry-target="line">
                      <%= line_form.hidden_field :side, value: "debit" %>
                      <% if line_form.object.persisted? %>
                        <%= line_form.hidden_field :id %>
                      <% end %>

                      <!-- 勘定科目 -->
                      <div class="col-span-6 border-r p-0">
                        <%= line_form.select :account_id,
                            options_from_collection_for_select(@accounts, :id, :name, line_form.object.account_id),
                            { prompt: "選択してください" },
                            { class: "w-full h-full px-2 py-2 border-0 font-mono text-sm focus:outline-none focus:bg-yellow-100" } %>
                      </div>

                      <!-- 金額 -->
                      <div class="col-span-4 border-r p-0">
                        <%= line_form.number_field :amount,
                            placeholder: "0",
                            min: 1,
                            max: 999999999999,
                            class: "w-full h-full px-2 py-2 border-0 font-mono text-sm text-right focus:outline-none focus:bg-yellow-100",
                            data: { action: "input->journal-entry#updateTotals" } %>
                      </div>

                      <!-- 削除 -->
                      <div class="col-span-2 border-r p-0 flex justify-center items-center">
                        <% if line_form.object.persisted? %>
                          <%= line_form.check_box :_destroy, { data: { action: "change->journal-entry#markForDestroy" }, class: "w-4 h-4" }, "1", "" %>
                        <% else %>
                          <button type="button"
                                  class="w-full h-full text-red-600 hover:bg-red-100 font-mono text-xs"
                                  data-action="click->journal-entry#removeLine"
                                  aria-label="削除">
                            ×
                          </button>
                        <% end %>
                      </div>
                    </div>
                  <% end %>
                <% end %>
              </div>

              <!-- 借方行追加ボタン -->
              <div class="py-2">
                <div class="text-center">
                  <button type="button"
                          class="bg-black hover:bg-gray-800 focus:bg-gray-700 focus:ring-4 focus:ring-gray-400 focus:outline-none text-white px-4 py-2 font-mono text-sm border border-gray-400"
                          data-action="click->journal-entry#addDebitLine">
                    + 借方行追加
                  </button>
                </div>
              </div>
            </div>

            <!-- 貸方側 -->
            <div>
              <!-- 貸方ヘッダー -->
              <div class="bg-gray-100 py-2 text-center font-mono font-bold border-b-1 border-black">
                貸方
              </div>

              <!-- 貸方列ヘッダー -->
              <div class="grid grid-cols-12 border-b bg-gray-100">
                <div class="col-span-6 border-r py-2 text-center font-mono font-bold text-sm">勘定科目</div>
                <div class="col-span-4 border-r py-2 text-center font-mono font-bold text-sm">金額</div>
                <div class="col-span-2 py-2 text-center font-mono font-bold text-sm">削除</div>
              </div>

              <!-- 貸方明細行 -->
              <div data-journal-entry-target="creditContainer">
                <%= form.fields_for :journal_entry_lines do |line_form| %>
                  <% if line_form.object.side == "credit" %>
                    <div class="grid grid-cols-12 border-b hover:bg-gray-50" data-journal-entry-target="line">
                      <%= line_form.hidden_field :side, value: "credit" %>
                      <% if line_form.object.persisted? %>
                        <%= line_form.hidden_field :id %>
                      <% end %>

                      <!-- 勘定科目 -->
                      <div class="col-span-6 border-r p-0">
                        <%= line_form.select :account_id,
                            options_from_collection_for_select(@accounts, :id, :name, line_form.object.account_id),
                            { prompt: "選択してください" },
                            { class: "w-full h-full px-2 py-2 border-0 font-mono text-sm focus:outline-none focus:bg-yellow-100" } %>
                      </div>

                      <!-- 金額 -->
                      <div class="col-span-4 border-r p-0">
                        <%= line_form.number_field :amount,
                            placeholder: "0",
                            min: 1,
                            max: 999999999999,
                            class: "w-full h-full px-2 py-2 border-0 font-mono text-sm text-right focus:outline-none focus:bg-yellow-100",
                            data: { action: "input->journal-entry#updateTotals" } %>
                      </div>

                      <!-- 削除 -->
                      <div class="col-span-2 p-0 flex justify-center items-center">
                        <% if line_form.object.persisted? %>
                          <%= line_form.check_box :_destroy, { data: { action: "change->journal-entry#markForDestroy" }, class: "w-4 h-4" }, "1", "" %>
                        <% else %>
                          <button type="button"
                                  class="w-full h-full font-mono text-xs cursor-pointer"
                                  data-action="click->journal-entry#removeLine"
                                  aria-label="削除">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                          </button>
                        <% end %>
                      </div>
                    </div>
                  <% end %>
                <% end %>
              </div>

              <!-- 貸方行追加ボタン -->
              <div class="py-2">
                <div class="text-center">
                  <button type="button"
                          class="bg-black hover:bg-gray-800 focus:bg-gray-700 focus:ring-4 focus:ring-gray-400 focus:outline-none text-white px-4 py-2 font-mono text-sm border border-gray-400"
                          data-action="click->journal-entry#addCreditLine">
                    + 貸方行追加
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


    <div class="bg-black text-white px-8 py-6 border-t-4 border-black">
      <div class="flex justify-center items-center">
        <div class="flex space-x-12 text-lg font-mono">
          <div class="text-white">
            借方合計: <span data-journal-entry-target="debitTotal" class="font-bold text-xl">0</span>円
          </div>
          <div class="text-white">
            貸方合計: <span data-journal-entry-target="creditTotal" class="font-bold text-xl">0</span>円
          </div>
          <div class="text-white">
            差額: <span data-journal-entry-target="difference" class="font-bold text-xl">0</span>円
          </div>
        </div>
      </div>
    </div>

      <div class="flex justify-center mt-8">
        <%= form.submit "保存", class: "bg-black hover:bg-gray-800 focus:bg-gray-700 focus:ring-4 focus:ring-gray-400 focus:outline-none text-white font-bold py-4 px-12 border-2 border-black font-mono text-xl tracking-widest" %>
      </div>
    <% end %>
  </div>
</div>
